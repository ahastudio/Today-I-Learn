# 3장

## 개요
- 2장에 이어서 블로그 앱을 만들어 봄
- 글 등록, 열람, **태그 달기**(내가 해보고 싶었던 것),
댓글 및 검색 기능, 콘텐츠 생성 및 편집 기능도 다룰 예정
- 3장에서는 포스트를 등록하고 읽을 수 있는 기능을 먼저 개발함

Bla bla <sup id="a1">[1](#f1)</sup>

## 3.1 애플리케이션 설계하기
- 블로그의 글, 즉 포스트에 대한 리스트 보여주기
- 포스트 클릭 시 해당 글 보여주기

### 3.1.1 화면 UI 설계
- 포스트 관련된 모델 필드의 항목들을 보여줄 것임

### 3.1.2 테이블 설계

| 필드명      | 타입           | 제약 조건          | 설명                   |
|-------------|----------------|--------------------|------------------------|
| id          | Integer        | PK, Auto Increment | 기본 키                |
| title       | CharField(50)  |                    | 포스트 제목            |
| slug        | SlugField(50)  | Unique             | 포스트 제목 별칭       |
| description | CharField(100) | Blank              | 포스트 내용 한 줄 설명 |
| content     | TextField      |                    | 포스트 내용 기록       |
| create_date | DateTimeField  | auto_now_add       | 포스트를 생성한 날짜   |
| modify_date | DateTimeField  | auto_now           | 포스트를 수정한 날짜   |

### 3.1.3 로직 설계
- 실제 프로젝트에서 로직 설계는 중요한 단계임
- 개발 대상 기능을 도출하고, 모델 - 뷰 - 템플릿 배치를 결정함
- 개발 기능이 누락되지 않도록 도출해야 함
- 기능 도출 후 URL 설계에 누락되지 않게 반영해야 함
- 규모가 큰 프로젝트면 반드시해야하지만 규모가 작을 경우 생략 가능
- 이 애플리케이션도 로직 설계를 3.1.4인 URL 설계로 대체함

### 3.1.4 URL 설계
- 간단한 프로젝트라도 URL 설계는 생략 할 수 없음
- 테이블 설계와는 독립적으로 진행 가능
- 기능 개발은 URL을 정의하는 것에서부터 시작됨
- **거창한 설계는 아니더라도 어떤 URL이 필요하고 필요한 URL들을 어떻게 구성할지** 등은
미리 설계하는 것이 바람직함
- 다음은 블로그 앱에서 필요한 URL을 설계한 내용임

| URL 패턴                   | 뷰 이름                   | 템플릿 파일명           |
|----------------------------|---------------------------|-------------------------|
| /blog/                     | PostLV(ListView)          | post_all.html           |
| /blog/post/                | PostLV(ListView)          | post_all.html           |
| /blog/post/django-example/ | PostDV(DetailView)        | post_detail.html        |
| /blog/archive/             | PostAV(ArchiveIndexView)  | post_archive.html       |
| /blog/2012/                | PostYAV(YearArchiveView)  | post_archive_year.html  |
| /blog/2012/nov/            | PostMAV(MonthArchiveView) | post_archive_month.html |
| /blog/2012/nov/10/[^2]         | PostDAV(DayArchiveView)   | post_archive_day.html   |
| /blog/today/               | PostTAV(TodayArchiveView) | post_archive_day.html   |
| /admin/                    | (장고 제공 기능)          |                         |


[^2]: URL 패턴에서 /2012/nov/10/은 예시로 /연/월/일/이 채워지는 자리임

### 3.1.5 작업/코딩 순서
- 작업 순서는 다음과 같음
- model 중 DateTimeField 타입이 있으므로 pytz 패키지를 설치해야함 
```python
pip install pytz
```

| 작업 순서        |   관련 명령/파일   |           필요한 작업 내용 |
|------------------|:------------------:|---------------------------:|
| 뼈대 만들기      |    startproject    |                  (이미 함) |
|                  |     settings.py    |                            |
|                  |       migrate      |                            |
|                  | createsuperuser    |                            |
|                  | startapp           | 블로그 앱을 생성           |
|                  | settings.py        | 블로그 앱을 등록           |
| 모델 코딩하기    | models.py          | 모델(테이블) 정의          |
|                  | admin.py           | Admin 사이트에 모델 등록   |
|                  | makemigrations     | 모델을 데이터베이스에 반영 |
|                  | migrate            |                            |
| URLconf 코딩하기 | urls.py            | URL 정의                   |
| 뷰 코딩하기      | views.py           | 뷰 로직 작성               |
| 템플릿 코딩하기  | templates 디렉터리 | 템플릿 파일 작성           |
| 그 외 코딩하기   | -                  | 없음                       |

## 3.2 개발 코딩하기

### 3.2.1 뼈대 만들기
-
```python
python manage.py startapp blog
``` 

```python
INSTALLED_APPS = [
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',
    'bookmark.apps.BookmarkConfig',     # 추가
    'blog.apps.BlogConfig',             # 추가

]
```

### 3.2.2 모델 코딩하기
```python
from django.db import models
from django.urls import reverse


# Create your models here.
class Post(models.Model):
    title = models.CharField('TITLE', max_length=50)
    slug = models.SlugField('SLUG', unique=True, allow_unicode=True, help_text='one word for title alias.')
    description = models.CharField('DESCRIPTION', max_length=100, blank=True, help_text='simple description text.')
    content = models.TextField('CONTENT')
    create_date = models.DateTimeField('Create Date', auto_now_add=True)
    modify_date = models.DateTimeField('Modify Date', auto_now=True)

    class Meta:
        verbose_name = 'post'
        verbose_name_plural = 'posts'
        db_table = 'my_post'
        ordering = ('-modify_date',)


    def __str__(self):
        return self.title


    def get_absolute_url(self):
        return reverse('blog:post_detail', args=(self.slug,))


    def get_previous_post(self):
        return self.get_previous_by_modify_date()


    def get_next_post(self):
        return self.get_next_by_modify_date()

```

- [Verbose field names](https://docs.djangoproject.com/en/2.1/topics/db/models/#verbose-field-names)
링크에 제공된 내용처럼 각각의 필드 타입의 첫번째 인자로 Verbose name을 설정할 수 있다.
- blank: 빈칸도 가능함
- auto_now_add: 객체가 생성될 때의 시각을 자동으로 기록
- auto_now: 객체가 데이터베이스에 저장될 때의 시각을 자동으로 기록
- 필드 속성 외에 필요한 파라미터가 있으면
[Meta 내부 클래스](https://docs.djangoproject.com/en/2.1/ref/models/options/)로 정의함
- verbose_name: 테이블의 단수형 별칭을 설정
- verbose_name_plural: 테이블의 복수형 별칭을 설정
- db_table: 데이터베이스에 저장되는테이블의 이름을 설정, default 값은 '앱명_모델클래스명'임 이 경우 blog_post가 됨
- ordering: 정렬 설정함 modify_date 컬럼을 기준으로 내림차순으로 설정




Footnotes
=========

<b id="f1">1</b> Footnote content here. [↩](#a1)


django-example과 같은 단어를 slug라고 하며, 기본 키 대용으로 자주 사용함